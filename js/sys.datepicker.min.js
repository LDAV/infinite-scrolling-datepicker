(function(a){a.date_picker={setDefaults:function(b){this._defaults=a.extend({},this._defaults,b)},_defaults:{onSelect:null,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],firstDay:0,prevYearText:"&lt;&lt;",prevText:"&lt;",currentText:"Today",nextText:"&gt;",nextYearText:"&gt;&gt;",convertISOToDisplayDate:false,convertDisplayDateToISO:false}};a.fn.date_picker=function(n,j){var h=5;function m(p,q,o){return("0000"+p).slice(-4)+"-"+("00"+q).slice(-2)+"-"+("00"+o).slice(-2)}function k(x,u,p){var q='<div class="sys-datepicker-month" data-year="'+x+'" data-month="'+u+'">';q+='<div class="sys-datepicker-month-header">'+p.monthNames[u-1]+" "+x+"</div>";q+='<div class="sys-datepicker-month-days">';var v=(new Date(m(x,u,1))).getUTCDay(),t=u==4||u==6||u==9||u==11?30:(u==2?(x&3||!(x%25)&&x&15?28:29):31);for(var s=0;s<(v+7-p.firstDay)%7;s++){q+='<div class="sys-datepicker-placeholder"></div>'}var y=b(),z=v;for(var w=1;w<=t;w++){var o=["sys-datepicker-day"],r=m(x,u,w);if(r==y){o.push("sys-datepicker-day-today")}if(z==0||z==6){o.push("sys-datepicker-day-weekend")}q+='<div class="'+o.join(" ")+'" data-date="'+r+'">'+w+"</div>";z=(z+1)%7}q+="</div></div>";return q}function c(r,q){var p='<div class="sys-datepicker-year" data-year="'+r+'">';for(var o=1;o<=12;o++){p=p+k(r,o,q)}p=p+"</div>";return p}function i(t,q,p){var s=t.find(".sys-datepicker-body");var o=a(".sys-datepicker-year:eq(-1)").data("year");var r;if(q>o){s.append(c(q,p));r=s.scrollTop();t.find(".sys-datepicker-year:eq(0)").remove();s.scrollTop(r-t.find(".sys-datepicker-year:eq(0)").outerHeight(true))}else{r=s.scrollTop();s.prepend(c(q,p));s.scrollTop(r+t.find(".sys-datepicker-year:eq(0)").outerHeight(true));t.find(".sys-datepicker-year:eq(-1)").remove()}}function e(s,p){var r=s.find(".sys-datepicker-body"),o=parseInt(p.defaultDate);for(var q=o-(h-1)/2;q<=o+(h-1)/2;q++){r.append(c(q,p))}}function g(v,r,s,q){var u=v.find(".sys-datepicker-body");var o='.sys-datepicker-month[data-year="'+r+'"]';if(s>=1&&s<=12){o=o+'[data-month="'+s+'"]'}var p=v.find(o);if(p.length==0){i(v,r,q);p=v.find(o)}v.find('.sys-datepicker-year:not([data-year="'+r+'"])').remove();var t;for(t=r-1;t>=r-(h-1)/2;t--){u.prepend(c(t,q))}for(t=r+1;t<=r+(h-1)/2;t++){u.append(c(t,q))}u.scrollTop(u.scrollTop()+p.position().top);v.find(".sys-datepicker-day").removeClass("current");v.find(".sys-datepicker-day[data-date="+q.defaultDate+"]").addClass("current")}function f(p){var o;p.find(".sys-datepicker-month").each(function(){var q=a(this);if(q.position().top+q.outerHeight(true)/2>0){o={year:q.data("year"),month:q.data("month")};return false}});return o}function b(){var o=new Date();return m(o.getFullYear(),o.getMonth()+1,o.getDate())}function l(o){return o.match(/^\d{4}-\d{2}-\d{2}/)==true}var d=a.extend({},a.date_picker._defaults);if(typeof d.defaultDate==="undefined"||!l(d.defaultDate)){d.defaultDate=b()}d=a.extend(d,n);if(n=="show"){this.trigger("show.sys-datepicker")}else{if(n=="hide"){this.trigger("hide.sys-datepicker")}else{if(n=="addDates"){this.trigger("addDates.sys-datepicker",[j])}else{if(n=="removeDates"){this.trigger("removeDates.sys-datepicker",[j])}else{this.each(function(){var q=a(this);if(q.hasClass("sys-datepicker-attached")){return}q.addClass("sys-datepicker-attached");var u=a('<div class="sys-datepicker" style="display:none"/>').appendTo("body"),t=a('<div class="sys-datepicker-content"/>').appendTo(u),x=a('<div class="sys-datepicker-header"><div class="sys-datepicker-buttons"><div class="sys-datepicker-button sys-datepicker-button-prevyear">'+d.prevYearText+'</div> <div class="sys-datepicker-button sys-datepicker-button-prevmonth">'+d.prevText+'</div> <div class="sys-datepicker-button sys-datepicker-button-today">'+d.currentText+'</div> <div class="sys-datepicker-button sys-datepicker-button-nextmonth">'+d.nextText+'</div> <div class="sys-datepicker-button sys-datepicker-button-nextyear">'+d.nextYearText+"</div></div></div>").appendTo(t),z=a('<div class="sys-datepicker-body"/>').appendTo(t),A=[],y="";var p=a('<div class="sys-datepicker-days"/>').appendTo(x);for(var w=d.firstDay;w<=d.firstDay+6;w++){var v='<div class="sys-datepicker-days-dow',B=w%7;if(B==0||B==6){v=v+" sys-datepicker-day-weekend"}a(v+'">'+(decodeURIComponent(escape(d.dayNamesMin[B]))+"</div>")).appendTo(p)}e(u,d);u.show();g(u,parseInt(d.defaultDate),parseInt(d.defaultDate.slice(5,7)),d);u.hide();z.on("scroll",function(){var E=f(u);if(typeof E!="undefined"){var D=z.find(".sys-datepicker-year:eq(0)").data("year"),C=z.find(".sys-datepicker-year:eq(-1)").data("year");if(E.year==C){i(u,C+1,d)}else{if(E.year==D){i(u,D-1,d)}}}});q.on("keyup change",function(){var F=a(this).val(),C,D,E;if(a.isFunction(d.convertDisplayDateToISO)){F=d.convertDisplayDateToISO(F);if(typeof F!=="string"&&!(F instanceof String)){return}}C=F.trim().match(/^(\d{4})(-((\d{2})(-(\d{2})?)?)?)?$/);if(!!C&&!!C[1]){D=parseInt(C[1]);E=C[3]?Math.max(1,Math.min(12,parseInt(C[3]))):1;g(u,D,E,d);o(F.trim())}});u.on("mouseenter",".sys-datepicker-day,.sys-datepicker-button",function(){a(this).addClass("sys-datepicker-hover")});u.on("mouseleave",".sys-datepicker-day,.sys-datepicker-button",function(){a(this).removeClass("sys-datepicker-hover")});u.on("click",".sys-datepicker-day",function(){var C=a(this).data("date");if(a.isFunction(d.convertISOToDisplayDate)){C=d.convertISOToDisplayDate(C)}q.val(C);var D=new Event("change");q[0].dispatchEvent(D);if(a.isFunction(d.onSelect)){d.onSelect.call(q.eq(0),C)}u.hide()});u.on("click",".sys-datepicker-button-prevmonth",function(){var C=f(u);C.month=C.month-1;if(C.month==0){C.year=C.year-1;C.month=12}g(u,C.year,C.month,d)});u.on("click",".sys-datepicker-button-nextmonth",function(){var C=f(u);C.month=C.month+1;if(C.month==13){C.year=C.year+1;C.month=1}g(u,C.year,C.month,d)});u.on("click",".sys-datepicker-button-prevyear",function(){var C=f(u);g(u,C.year-1,C.month,d)});u.on("click",".sys-datepicker-button-nextyear",function(){var C=f(u);g(u,C.year+1,C.month,d)});u.on("click",".sys-datepicker-button-today",function(){var C=new Date();g(u,C.getFullYear(),C.getMonth()+1,d)});q.on("focus click show.sys-datepicker",function(){var D=q.offset();o(q.val().trim());var E=D.top;if(E+306>document.body.clientHeight){E=D.top-306}else{E=E+q.outerHeight()}E=E<0?0:E;var C=D.left;if(C+306>document.body.clientWidth){C=D.left+q.outerWidth()-250}C=C<0?0:C;if(a.isFunction(d.convertDisplayDateToISO)){d.defaultDate=d.convertDisplayDateToISO(q.val().trim())}g(u,parseInt(d.defaultDate),parseInt(d.defaultDate.slice(5,7)),d);u.css({position:"absolute",left:C,top:E});u.show()});q.on("keydown",function(C){if(C.keyCode==9||C.keyCode==27){u.hide()}});a(document).on("click",function(C){if(a(C.target).closest(".sys-datepicker").get(0)!=u.get(0)&&a(C.target).closest(".sys-datepicker-attached").get(0)!=q.get(0)){u.hide()}});q.on("hide.sys-datepicker",function(){u.hide()});function s(C){for(var D in A){if(A[D]==C){return}}A.push(C);u.find('.sys-datepicker-day[data-date="'+C+'"]').addClass("sys-datepicker-day-selected")}function r(C){var E=[];for(var D in A){if(A[D]!=C){E.push(A[D])}}A=E;u.find('.sys-datepicker-day[data-date="'+C+'"]').removeClass("sys-datepicker-day-selected")}function o(D){u.find('.sys-datepicker-day[data-date="'+y+'"]').removeClass("sys-datepicker-day-input");var C=false;for(var E in A){if(A[E]==y){C=true;break}}if(!C){u.find('.sys-datepicker-day[data-date="'+y+'"]').removeClass("sys-datepicker-day-selected")}y=D;u.find('.sys-datepicker-day[data-date="'+y+'"]').addClass("sys-datepicker-day-selected sys-datepicker-day-input")}q.on("addDates.sys-datepicker",function(E,D){if(Object.prototype.toString.call(D)==="[object Array]"){for(var C in D){s(D[C])}}else{s(D)}});q.on("removeDates.sys-datepicker",function(E,D){if(Object.prototype.toString.call(D)==="[object Array]"){for(var C in D){r(D[C])}}else{r(D)}})})}}}}return this}})(jQuery);
